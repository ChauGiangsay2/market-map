<!-- Header -->
<div class="header-bar">
  <h2>Qu·∫£n l√Ω S·∫°p</h2>
  <div class="header-actions">
    <button pButton label="üîî C√≥ 3 s·∫°p ch·ªù duy·ªát" class="p-button-warning p-button-sm" (click)="showPending()">
    </button>
    <button pButton label="Th√™m m·ªõi" icon="pi pi-plus" class="p-button-primary p-button-sm" (click)="openNew()">
    </button>
  </div>
</div>

<!-- B·∫£ng danh s√°ch -->
<p-table [value]="stalls" [paginator]="true" [rows]="5" responsiveLayout="scroll">
  <ng-template pTemplate="header">
    <tr>
      <th>T√™n s·∫°p</th>
      <th>ƒê·ªãa ch·ªâ</th>
      <th>Gi·ªù ho·∫°t ƒë·ªông</th>
      <th>Li√™n h·ªá</th>
      <th>M·∫∑t h√†ng</th>
      <th>Rating</th>
      <th>H√†nh ƒë·ªông</th>
    </tr>
  </ng-template>
  <ng-template pTemplate="body" let-stall>
    <tr>
      <td>{{ stall.name }}</td>
      <td>{{ stall.address }}</td>
      <td>{{ stall.openHours }}</td>
      <td>{{ stall.contact }}</td>
      <td>{{ stall.items }}</td>
      <td>{{ stall.rating }} ‚≠ê</td>
      <td>
        <button pButton icon="pi pi-pencil" class="p-button-text" (click)="editStall(stall)"></button>
        <button pButton icon="pi pi-trash" class="p-button-text p-button-danger" (click)="deleteStall(stall)"></button>
      </td>
    </tr>
  </ng-template>
</p-table>

<!-- Dialog th√™m/s·ª≠a -->
<p-dialog [(visible)]="dialogVisible" [modal]="true" [style]="{ width: '500px' }"
  [header]="isEdit ? 'S·ª≠a s·∫°p' : 'Th√™m s·∫°p'">
  <form [formGroup]="form" class="p-fluid form-grid">
    <div class="p-field">
      <label for="name">T√™n s·∫°p</label>
      <input id="name" pInputText formControlName="name" />
    </div>

    <div class="p-field">
      <label for="address">ƒê·ªãa ch·ªâ</label>
      <input id="address" pInputText formControlName="address" />

       <button pButton 
          label="Ch·ªçn s·∫°p tr·ªëng" 
          icon="pi pi-map" 
          (click)="showStallDialog()"
          class="p-button-secondary p-ml-2">
  </button>
    </div>

    <div class="p-field">
      <label for="openHours">Gi·ªù ho·∫°t ƒë·ªông</label>
      <input id="openHours" pInputText formControlName="openHours" />
    </div>

    <div class="p-field">
      <label for="contact">Li√™n h·ªá</label>
      <input id="contact" pInputText formControlName="contact" />
    </div>

    <div class="p-field">
      <label for="items">M·∫∑t h√†ng</label>
      <input id="items" pInputText formControlName="items" />
    </div>

    <div class="p-field">
      <label for="images">·∫¢nh (t·∫£i l√™n)</label>
      <p-fileUpload name="images[]" customUpload="true" (onSelect)="onImageSelect($event)" [showUploadButton]="false"
        [showCancelButton]="false" chooseLabel="Ch·ªçn ·∫£nh" multiple="false" accept="image/*">
      </p-fileUpload>

      <div *ngIf="previewImage" class="preview-container">
        <img [src]="previewImage" alt="Xem tr∆∞·ªõc" class="preview-img" />
      </div>
    </div>
  </form>

  <p-footer>
    <button pButton label="H·ªßy" icon="pi pi-times" class="p-button-text" (click)="dialogVisible=false"></button>
    <button pButton label="L∆∞u" icon="pi pi-check" (click)="save()" [disabled]="form.invalid"></button>
  </p-footer>
</p-dialog>

<p-dialog header="S·∫°p ƒëang ch·ªù duy·ªát" [(visible)]="pendingDialogVisible" [modal]="true" [style]="{ width: '650px' }">
  <div *ngFor="let stall of pendingStalls" class="pending-card">
    <img [src]="stall.images[0]" alt="·∫¢nh s·∫°p"
      style="width: 100px; height: 70px; object-fit: cover; border-radius: 4px; margin-right: 10px;" />
    <div style="flex: 1;">
      <h4 style="margin: 0;">{{ stall.name }}</h4>
      <p style="margin: 2px 0;"><strong>ƒê·ªãa ch·ªâ:</strong> {{ stall.address }}</p>
      <p style="margin: 2px 0;"><strong>Li√™n h·ªá:</strong> {{ stall.contact }}</p>
      <p style="margin: 2px 0;"><strong>M·∫∑t h√†ng:</strong> {{ stall.items }}</p>
      <p style="margin: 2px 0;"><strong>Gi·ªù ho·∫°t ƒë·ªông:</strong> {{ stall.openHours }}</p>



    </div>
    <div class="action-buttons">
        <button pButton label="Duy·ªát" icon="pi pi-check" class="p-button-success p-button-sm"
          (click)="approveStall(stall)">
        </button>
        <button pButton label="Kh√¥ng duy·ªát" icon="pi pi-times" class="p-button-danger p-button-sm"
          (click)="rejectStall(stall)">
        </button>
      </div>
  </div>

  <p-footer>
    <button pButton label="ƒê√≥ng" icon="pi pi-times" class="p-button-text"
      (click)="pendingDialogVisible = false"></button>
  </p-footer>
</p-dialog>



<!-- dialog -->

<p-dialog header="Ch·ªçn s·∫°p tr·ªëng" 
          [(visible)]="stallDialogVisible" 
          [modal]="true" 
          [style]="{width: '60vw'}">
  
  <div class="map-container">
    <img src="hihi.png" class="market-map"/>

    <!-- V√≠ d·ª• hi·ªÉn th·ªã overlay √¥ tr·ªëng -->
    <!-- <div *ngFor="let stall of stallss"
         class="stall-box"
         [style.left.%]="stall.x"
         [style.top.%]="stall.y"
         [class.occupied]="stall.occupied"
         (click)="selectStall(stall)">
      {{ stall.code }}
    </div> -->
  </div>
</p-dialog>


<!-- Popup x√°c nh·∫≠n -->
<p-confirmDialog></p-confirmDialog>

<!-- Toast -->
<p-toast></p-toast>
